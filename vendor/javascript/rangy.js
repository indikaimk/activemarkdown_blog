// rangy@1.3.2 downloaded from https://ga.jspm.io/npm:rangy@1.3.2/lib/rangy-core.js

var e=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var t={};(function(e,n){true;t=e()})((function(){var t="object",n="function",r="undefined";var a=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var o=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var i=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var s=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function isHostMethod(e,r){var a=typeof e[r];return a==n||!!(a==t&&e[r])||a=="unknown"}function isHostObject(e,n){return!!(typeof e[n]==t&&e[n])}function isHostProperty(e,t){return typeof e[t]!=r}function createMultiplePropertyTest(e){return function(t,n){var r=n.length;while(r--)if(!e(t,n[r]))return false;return true}}var c=createMultiplePropertyTest(isHostMethod);var d=createMultiplePropertyTest(isHostObject);var l=createMultiplePropertyTest(isHostProperty);function isTextRange(e){return e&&c(e,s)&&l(e,i)}function getBody(e){return isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}var f=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n],n)};var u={};var g=typeof window!=r&&typeof document!=r;var h={isHostMethod:isHostMethod,isHostObject:isHostObject,isHostProperty:isHostProperty,areHostMethods:c,areHostObjects:d,areHostProperties:l,isTextRange:isTextRange,getBody:getBody,forEach:f};var p={version:"1.3.2",initialized:false,isBrowser:g,supported:true,util:h,features:{},modules:u,config:{alertOnFail:false,alertOnWarn:false,preferTextRange:false,autoInitialize:typeof rangyAutoInitialize==r||rangyAutoInitialize}};function consoleLog(e){typeof console!=r&&isHostMethod(console,"log")&&console.log(e)}function alertOrLog(e,t){g&&t?alert(e):consoleLog(e)}function fail(e){p.initialized=true;p.supported=false;alertOrLog("Rangy is not supported in this environment. Reason: "+e,p.config.alertOnFail)}p.fail=fail;function warn(e){alertOrLog("Rangy warning: "+e,p.config.alertOnWarn)}p.warn=warn;var m;if({}.hasOwnProperty){h.extend=m=function(e,t,n){var r,a;for(var o in t)if(o!=="__proto__"&&o!=="constructor"&&o!=="prototype"&&t.hasOwnProperty(o)){r=e[o];a=t[o];n&&r!==null&&typeof r=="object"&&a!==null&&typeof a=="object"&&m(r,a,true);e[o]=a}t.hasOwnProperty("toString")&&(e.toString=t.toString);return e};h.createOptions=function(e,t){var n={};m(n,t);e&&m(n,e);return n}}else fail("hasOwnProperty not supported");g||fail("Rangy can only run in a browser");(function(){var e;if(g){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{n.call(t.childNodes,0)[0].nodeType==1&&(e=function(e){return n.call(e,0)})}catch(e){}}e||(e=function(e){var t=[];for(var n=0,r=e.length;n<r;++n)t[n]=e[n];return t});h.toArray=e})();var v;if(g){isHostMethod(document,"addEventListener")?v=function(e,t,n){e.addEventListener(t,n,false)}:isHostMethod(document,"attachEvent")?v=function(e,t,n){e.attachEvent("on"+t,n)}:fail("Document does not have required addEventListener or attachEvent method");h.addListener=v}var R=[];function getErrorDesc(e){return e.message||e.description||String(e)}function init(){if(g&&!p.initialized){var e;var t=false,n=false;if(isHostMethod(document,"createRange")){e=document.createRange();c(e,o)&&l(e,a)&&(t=true)}var r=getBody(document);if(r&&r.nodeName.toLowerCase()=="body"){if(r&&isHostMethod(r,"createTextRange")){e=r.createTextRange();isTextRange(e)&&(n=true)}if(t||n){p.initialized=true;p.features={implementsDomRange:t,implementsTextRange:n};var i,s;for(var d in u)(i=u[d])instanceof Module&&i.init(i,p);for(var f=0,h=R.length;f<h;++f)try{R[f](p)}catch(e){s="Rangy init listener threw an exception. Continuing. Detail: "+getErrorDesc(e);consoleLog(s)}}else fail("Neither Range nor TextRange are available")}else fail("No body element found")}}function deprecationNotice(e,t,n){n&&(e+=" in module "+n.name);p.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function createAliasForDeprecatedMethod(e,t,n,r){e[t]=function(){deprecationNotice(t,n,r);return e[n].apply(e,h.toArray(arguments))}}h.deprecationNotice=deprecationNotice;h.createAliasForDeprecatedMethod=createAliasForDeprecatedMethod;p.init=init;p.addInitListener=function(e){p.initialized?e(p):R.push(e)};var N=[];p.addShimListener=function(e){N.push(e)};function shim(e){e=e||window;init();for(var t=0,n=N.length;t<n;++t)N[t](e)}if(g){p.shim=p.createMissingNativeApi=shim;createAliasForDeprecatedMethod(p,"createMissingNativeApi","shim")}function Module(t,n,r){(this||e).name=t;(this||e).dependencies=n;(this||e).initialized=false;(this||e).supported=false;(this||e).initializer=r}Module.prototype={init:function(){var t=(this||e).dependencies||[];for(var n,r,a=0,o=t.length;a<o;++a){r=t[a];n=u[r];if(!n||!(n instanceof Module))throw new Error("required module '"+r+"' not found");n.init();if(!n.supported)throw new Error("required module '"+r+"' not supported")}this.initializer(this||e)},fail:function(t){(this||e).initialized=true;(this||e).supported=false;throw new Error(t)},warn:function(t){p.warn("Module "+(this||e).name+": "+t)},deprecationNotice:function(t,n){p.warn("DEPRECATED: "+t+" in module "+(this||e).name+" is deprecated. Please use "+n+" instead")},createError:function(t){return new Error("Error in Rangy "+(this||e).name+" module: "+t)}};function createModule(e,t,n){var r=new Module(e,t,(function(t){if(!t.initialized){t.initialized=true;try{n(p,t);t.supported=true}catch(t){var r="Module '"+e+"' failed to load: "+getErrorDesc(t);consoleLog(r);t.stack&&consoleLog(t.stack)}}}));u[e]=r;return r}p.createModule=function(e){var t,n;if(arguments.length==2){t=arguments[1];n=[]}else{t=arguments[2];n=arguments[1]}var r=createModule(e,n,t);p.initialized&&p.supported&&r.init()};p.createCoreModule=function(e,t,n){createModule(e,t,n)};function RangePrototype(){}p.RangePrototype=RangePrototype;p.rangePrototype=new RangePrototype;function SelectionPrototype(){}p.selectionPrototype=new SelectionPrototype;p.createCoreModule("DomUtil",[],(function(t,n){var r="undefined";var a=t.util;var o=a.getBody;a.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||n.fail("document missing a Node creation method");a.isHostMethod(document,"getElementsByTagName")||n.fail("document missing getElementsByTagName method");var i=document.createElement("div");a.areHostMethods(i,["insertBefore","appendChild","cloneNode"]||!a.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"]))||n.fail("Incomplete Element implementation");a.isHostProperty(i,"innerHTML")||n.fail("Element is missing innerHTML property");var s=document.createTextNode("test");a.areHostMethods(s,["splitText","deleteData","insertData","appendData","cloneNode"]||!a.areHostObjects(i,["previousSibling","nextSibling","childNodes","parentNode"])||!a.areHostProperties(s,["data"]))||n.fail("Incomplete Text Node implementation");var arrayContains=function(e,t){var n=e.length;while(n--)if(e[n]===t)return true;return false};function isHtmlNamespace(e){var t;return typeof e.namespaceURI==r||(t=e.namespaceURI)===null||t=="http://www.w3.org/1999/xhtml"}function parentElement(e){var t=e.parentNode;return t.nodeType==1?t:null}function getNodeIndex(e){var t=0;while(e=e.previousSibling)++t;return t}function getNodeLength(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function getCommonAncestor(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(arrayContains(r,n))return n;return null}function isAncestorOf(e,t,n){var r=n?t:t.parentNode;while(r){if(r===e)return true;r=r.parentNode}return false}function isOrIsAncestorOf(e,t){return isAncestorOf(e,t,true)}function getClosestAncestorIn(e,t,n){var r,a=n?e:e.parentNode;while(a){r=a.parentNode;if(r===t)return a;a=r}return null}function isCharacterDataNode(e){var t=e.nodeType;return t==3||t==4||t==8}function isTextOrCommentNode(e){if(!e)return false;var t=e.nodeType;return t==3||t==8}function insertAfter(e,t){var n=t.nextSibling,r=t.parentNode;n?r.insertBefore(e,n):r.appendChild(e);return e}function splitDataNode(e,t,n){var r=e.cloneNode(false);r.deleteData(0,t);e.deleteData(t,e.length-t);insertAfter(r,e);if(n)for(var a,o=0;a=n[o++];)if(a.node==e&&a.offset>t){a.node=r;a.offset-=t}else a.node==e.parentNode&&a.offset>getNodeIndex(e)&&++a.offset;return r}function getDocument(e){if(e.nodeType==9)return e;if(typeof e.ownerDocument!=r)return e.ownerDocument;if(typeof e.document!=r)return e.document;if(e.parentNode)return getDocument(e.parentNode);throw n.createError("getDocument: no document found for node")}function getWindow(e){var t=getDocument(e);if(typeof t.defaultView!=r)return t.defaultView;if(typeof t.parentWindow!=r)return t.parentWindow;throw n.createError("Cannot get a window object for node")}function getIframeDocument(e){if(typeof e.contentDocument!=r)return e.contentDocument;if(typeof e.contentWindow!=r)return e.contentWindow.document;throw n.createError("getIframeDocument: No Document object found for iframe element")}function getIframeWindow(e){if(typeof e.contentWindow!=r)return e.contentWindow;if(typeof e.contentDocument!=r)return e.contentDocument.defaultView;throw n.createError("getIframeWindow: No Window object found for iframe element")}function isWindow(e){return e&&a.isHostMethod(e,"setTimeout")&&a.isHostObject(e,"document")}function getContentDocument(e,t,n){var r;e?a.isHostProperty(e,"nodeType")?r=e.nodeType==1&&e.tagName.toLowerCase()=="iframe"?getIframeDocument(e):getDocument(e):isWindow(e)&&(r=e.document):r=document;if(!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r}function getRootContainer(e){var t;while(t=e.parentNode)e=t;return e}function comparePoints(e,t,r,a){var o,i,s,c,d;if(e==r)return t===a?0:t<a?-1:1;if(o=getClosestAncestorIn(r,e,true))return t<=getNodeIndex(o)?-1:1;if(o=getClosestAncestorIn(e,r,true))return getNodeIndex(o)<a?-1:1;i=getCommonAncestor(e,r);if(!i)throw new Error("comparePoints error: nodes have no common ancestor");s=e===i?i:getClosestAncestorIn(e,i,true);c=r===i?i:getClosestAncestorIn(r,i,true);if(s===c)throw n.createError("comparePoints got to case 4 and childA and childB are the same!");d=i.firstChild;while(d){if(d===s)return-1;if(d===c)return 1;d=d.nextSibling}}var c=false;function isBrokenNode(e){try{e.parentNode;return false}catch(e){return true}}(function(){var e=document.createElement("b");e.innerHTML="1";var n=e.firstChild;e.innerHTML="<br />";c=isBrokenNode(n);t.features.crashyTextNodes=c})();function inspectNode(e){if(!e)return"[No node]";if(c&&isBrokenNode(e))return"[Broken node]";if(isCharacterDataNode(e))return'"'+e.data+'"';if(e.nodeType==1){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+getNodeIndex(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function fragmentFromNodeChildren(e){var t,n=getDocument(e).createDocumentFragment();while(t=e.firstChild)n.appendChild(t);return n}var d;typeof window.getComputedStyle!=r?d=function(e,t){return getWindow(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=r?d=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:n.fail("No means of obtaining computed style properties found");function createTestElement(e,t,n){var r=o(e);var a=e.createElement("div");a.contentEditable=""+!!n;t&&(a.innerHTML=t);var i=r.firstChild;i?r.insertBefore(a,i):r.appendChild(a);return a}function removeNode(e){return e.parentNode.removeChild(e)}function NodeIterator(t){(this||e).root=t;(this||e)._next=t}NodeIterator.prototype={_current:null,hasNext:function(){return!!(this||e)._next},next:function(){var t=(this||e)._current=(this||e)._next;var n,r;if((this||e)._current){n=t.firstChild;if(n)(this||e)._next=n;else{r=null;while(t!==(this||e).root&&!(r=t.nextSibling))t=t.parentNode;(this||e)._next=r}}return(this||e)._current},detach:function(){(this||e)._current=(this||e)._next=(this||e).root=null}};function createIterator(e){return new NodeIterator(e)}function DomPosition(t,n){(this||e).node=t;(this||e).offset=n}DomPosition.prototype={equals:function(t){return!!t&&(this||e).node===t.node&&(this||e).offset==t.offset},inspect:function(){return"[DomPosition("+inspectNode((this||e).node)+":"+(this||e).offset+")]"},toString:function(){return this.inspect()}};function DOMException(t){(this||e).code=(this||e)[t];(this||e).codeName=t;(this||e).message="DOMException: "+(this||e).codeName}DOMException.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};DOMException.prototype.toString=function(){return(this||e).message};t.dom={arrayContains:arrayContains,isHtmlNamespace:isHtmlNamespace,parentElement:parentElement,getNodeIndex:getNodeIndex,getNodeLength:getNodeLength,getCommonAncestor:getCommonAncestor,isAncestorOf:isAncestorOf,isOrIsAncestorOf:isOrIsAncestorOf,getClosestAncestorIn:getClosestAncestorIn,isCharacterDataNode:isCharacterDataNode,isTextOrCommentNode:isTextOrCommentNode,insertAfter:insertAfter,splitDataNode:splitDataNode,getDocument:getDocument,getWindow:getWindow,getIframeWindow:getIframeWindow,getIframeDocument:getIframeDocument,getBody:o,isWindow:isWindow,getContentDocument:getContentDocument,getRootContainer:getRootContainer,comparePoints:comparePoints,isBrokenNode:isBrokenNode,inspectNode:inspectNode,getComputedStyleProperty:d,createTestElement:createTestElement,removeNode:removeNode,fragmentFromNodeChildren:fragmentFromNodeChildren,createIterator:createIterator,DomPosition:DomPosition};t.DOMException=DOMException}));p.createCoreModule("DomRange",["DomUtil"],(function(t,n){var r=t.dom;var a=t.util;var o=r.DomPosition;var i=t.DOMException;var s=r.isCharacterDataNode;var c=r.getNodeIndex;var d=r.isOrIsAncestorOf;var l=r.getDocument;var f=r.comparePoints;var u=r.splitDataNode;var g=r.getClosestAncestorIn;var h=r.getNodeLength;var p=r.arrayContains;var m=r.getRootContainer;var v=t.features.crashyTextNodes;var R=r.removeNode;function isNonTextPartiallySelected(e,t){return e.nodeType!=3&&(d(e,t.startContainer)||d(e,t.endContainer))}function getRangeDocument(e){return e.document||l(e.startContainer)}function getRangeRoot(e){return m(e.startContainer)}function getBoundaryBeforeNode(e){return new o(e.parentNode,c(e))}function getBoundaryAfterNode(e){return new o(e.parentNode,c(e)+1)}function insertNodeAtPosition(e,t,n){var a=e.nodeType==11?e.firstChild:e;s(t)?n==t.length?r.insertAfter(e,t):t.parentNode.insertBefore(e,n==0?t:u(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]);return a}function rangesIntersect(e,t,n){assertRangeValid(e);assertRangeValid(t);if(getRangeDocument(t)!=getRangeDocument(e))throw new i("WRONG_DOCUMENT_ERR");var r=f(e.startContainer,e.startOffset,t.endContainer,t.endOffset),a=f(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&a>=0:r<0&&a>0}function cloneSubtree(e){var t;for(var n,r,a=getRangeDocument(e.range).createDocumentFragment();n=e.next();){t=e.isPartiallySelectedSubtree();n=n.cloneNode(!t);if(t){r=e.getSubtreeIterator();n.appendChild(cloneSubtree(r));r.detach()}if(n.nodeType==10)throw new i("HIERARCHY_REQUEST_ERR");a.appendChild(n)}return a}function iterateSubtree(e,t,n){var a,o;n=n||{stop:false};for(var i,s;i=e.next();)if(e.isPartiallySelectedSubtree()){if(t(i)===false){n.stop=true;return}s=e.getSubtreeIterator();iterateSubtree(s,t,n);s.detach();if(n.stop)return}else{a=r.createIterator(i);while(o=a.next())if(t(o)===false){n.stop=true;return}}}function deleteSubtree(e){var t;while(e.next())if(e.isPartiallySelectedSubtree()){t=e.getSubtreeIterator();deleteSubtree(t);t.detach()}else e.remove()}function extractSubtree(e){for(var t,n,r=getRangeDocument(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()){t=t.cloneNode(false);n=e.getSubtreeIterator();t.appendChild(extractSubtree(n));n.detach()}else e.remove();if(t.nodeType==10)throw new i("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function getNodesInRange(e,t,n){var r,a=!!(t&&t.length);var o=!!n;a&&(r=new RegExp("^("+t.join("|")+")$"));var i=[];iterateSubtree(new RangeIterator(e,false),(function(t){if((!a||r.test(t.nodeType))&&(!o||n(t))){var c=e.startContainer;if(t!=c||!s(c)||e.startOffset!=c.length){var d=e.endContainer;t==d&&s(d)&&e.endOffset==0||i.push(t)}}}));return i}function inspect(e){var t=typeof e.getName=="undefined"?"Range":e.getName();return"["+t+"("+r.inspectNode(e.startContainer)+":"+e.startOffset+", "+r.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function RangeIterator(t,n){(this||e).range=t;(this||e).clonePartiallySelectedTextNodes=n;if(!t.collapsed){(this||e).sc=t.startContainer;(this||e).so=t.startOffset;(this||e).ec=t.endContainer;(this||e).eo=t.endOffset;var r=t.commonAncestorContainer;if((this||e).sc===(this||e).ec&&s((this||e).sc)){(this||e).isSingleCharacterDataNode=true;(this||e)._first=(this||e)._last=(this||e)._next=(this||e).sc}else{(this||e)._first=(this||e)._next=(this||e).sc!==r||s((this||e).sc)?g((this||e).sc,r,true):(this||e).sc.childNodes[(this||e).so];(this||e)._last=(this||e).ec!==r||s((this||e).ec)?g((this||e).ec,r,true):(this||e).ec.childNodes[(this||e).eo-1]}}}RangeIterator.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){(this||e)._current=null;(this||e)._next=(this||e)._first},hasNext:function(){return!!(this||e)._next},next:function(){var t=(this||e)._current=(this||e)._next;if(t){(this||e)._next=t!==(this||e)._last?t.nextSibling:null;if(s(t)&&(this||e).clonePartiallySelectedTextNodes){t===(this||e).ec&&(t=t.cloneNode(true)).deleteData((this||e).eo,t.length-(this||e).eo);(this||e)._current===(this||e).sc&&(t=t.cloneNode(true)).deleteData(0,(this||e).so)}}return t},remove:function(){var t,n,r=(this||e)._current;if(!s(r)||r!==(this||e).sc&&r!==(this||e).ec)r.parentNode&&R(r);else{t=r===(this||e).sc?(this||e).so:0;n=r===(this||e).ec?(this||e).eo:r.length;t!=n&&r.deleteData(t,n-t)}},isPartiallySelectedSubtree:function(){var t=(this||e)._current;return isNonTextPartiallySelected(t,(this||e).range)},getSubtreeIterator:function(){var t;if((this||e).isSingleCharacterDataNode){t=(this||e).range.cloneRange();t.collapse(false)}else{t=new Range(getRangeDocument((this||e).range));var n=(this||e)._current;var r=n,a=0,o=n,i=h(n);if(d(n,(this||e).sc)){r=(this||e).sc;a=(this||e).so}if(d(n,(this||e).ec)){o=(this||e).ec;i=(this||e).eo}updateBoundaries(t,r,a,o,i)}return new RangeIterator(t,(this||e).clonePartiallySelectedTextNodes)},detach:function(){(this||e).range=(this||e)._current=(this||e)._next=(this||e)._first=(this||e)._last=(this||e).sc=(this||e).so=(this||e).ec=(this||e).eo=null}};var N=[1,3,4,5,7,8,10];var C=[2,9,11];var S=[5,6,10,12];var y=[1,3,4,5,7,8,10,11];var E=[1,3,4,5,7,8];function createAncestorFinder(e){return function(t,n){var r,a=n?t:t.parentNode;while(a){r=a.nodeType;if(p(e,r))return a;a=a.parentNode}return null}}var T=createAncestorFinder([9,11]);var w=createAncestorFinder(S);var O=createAncestorFinder([6,10,12]);var D=createAncestorFinder([1]);function assertNoDocTypeNotationEntityAncestor(e,t){if(O(e,t))throw new i("INVALID_NODE_TYPE_ERR")}function assertValidNodeType(e,t){if(!p(t,e.nodeType))throw new i("INVALID_NODE_TYPE_ERR")}function assertValidOffset(e,t){if(t<0||t>(s(e)?e.length:e.childNodes.length))throw new i("INDEX_SIZE_ERR")}function assertSameDocumentOrFragment(e,t){if(T(e,true)!==T(t,true))throw new i("WRONG_DOCUMENT_ERR")}function assertNodeNotReadOnly(e){if(w(e,true))throw new i("NO_MODIFICATION_ALLOWED_ERR")}function assertNode(e,t){if(!e)throw new i(t)}function isValidOffset(e,t){return t<=(s(e)?e.length:e.childNodes.length)}function isRangeValid(e){return!!e.startContainer&&!!e.endContainer&&!(v&&(r.isBrokenNode(e.startContainer)||r.isBrokenNode(e.endContainer)))&&m(e.startContainer)==m(e.endContainer)&&isValidOffset(e.startContainer,e.startOffset)&&isValidOffset(e.endContainer,e.endOffset)}function assertRangeValid(e){if(!isRangeValid(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var A=document.createElement("style");var x=false;try{A.innerHTML="<b>x</b>";x=A.firstChild.nodeType==3}catch(e){}t.features.htmlParsingConforms=x;var _=x?function(t){var n=(this||e).startContainer;var a=l(n);if(!n)throw new i("INVALID_STATE_ERR");var o=null;n.nodeType==1?o=n:s(n)&&(o=r.parentElement(n));o=o===null||o.nodeName=="HTML"&&r.isHtmlNamespace(l(o).documentElement)&&r.isHtmlNamespace(o)?a.createElement("body"):o.cloneNode(false);o.innerHTML=t;return r.fragmentFromNodeChildren(o)}:function(t){var n=getRangeDocument(this||e);var a=n.createElement("body");a.innerHTML=t;return r.fragmentFromNodeChildren(a)};function splitRangeBoundaries(e,t){assertRangeValid(e);var n=e.startContainer,r=e.startOffset,a=e.endContainer,o=e.endOffset;var i=n===a;s(a)&&o>0&&o<a.length&&u(a,o,t);if(s(n)&&r>0&&r<n.length){n=u(n,r,t);if(i){o-=r;a=n}else a==n.parentNode&&o>=c(n)&&o++;r=0}e.setStartAndEnd(n,r,a,o)}function rangeToHtml(e){assertRangeValid(e);var t=e.commonAncestorContainer.parentNode.cloneNode(false);t.appendChild(e.cloneContents());return t.innerHTML}var P=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var I=0,b=1,B=2,M=3;var H=0,W=1,V=2,k=3;a.extend(t.rangePrototype,{compareBoundaryPoints:function(t,n){assertRangeValid(this||e);assertSameDocumentOrFragment((this||e).startContainer,n.startContainer);var r,a,o,i;var s=t==M||t==I?"start":"end";var c=t==b||t==I?"start":"end";r=(this||e)[s+"Container"];a=(this||e)[s+"Offset"];o=n[c+"Container"];i=n[c+"Offset"];return f(r,a,o,i)},insertNode:function(t){assertRangeValid(this||e);assertValidNodeType(t,y);assertNodeNotReadOnly((this||e).startContainer);if(d(t,(this||e).startContainer))throw new i("HIERARCHY_REQUEST_ERR");var n=insertNodeAtPosition(t,(this||e).startContainer,(this||e).startOffset);this.setStartBefore(n)},cloneContents:function(){assertRangeValid(this||e);var t,n;if((this||e).collapsed)return getRangeDocument(this||e).createDocumentFragment();if((this||e).startContainer===(this||e).endContainer&&s((this||e).startContainer)){t=(this||e).startContainer.cloneNode(true);t.data=t.data.slice((this||e).startOffset,(this||e).endOffset);n=getRangeDocument(this||e).createDocumentFragment();n.appendChild(t);return n}var r=new RangeIterator(this||e,true);t=cloneSubtree(r);r.detach();return t},canSurroundContents:function(){assertRangeValid(this||e);assertNodeNotReadOnly((this||e).startContainer);assertNodeNotReadOnly((this||e).endContainer);var t=new RangeIterator(this||e,true);var n=t._first&&isNonTextPartiallySelected(t._first,this||e)||t._last&&isNonTextPartiallySelected(t._last,this||e);t.detach();return!n},surroundContents:function(t){assertValidNodeType(t,E);if(!this.canSurroundContents())throw new i("INVALID_STATE_ERR");var n=this.extractContents();if(t.hasChildNodes())while(t.lastChild)t.removeChild(t.lastChild);insertNodeAtPosition(t,(this||e).startContainer,(this||e).startOffset);t.appendChild(n);this.selectNode(t)},cloneRange:function(){assertRangeValid(this||e);var t=new Range(getRangeDocument(this||e));var n,r=P.length;while(r--){n=P[r];t[n]=(this||e)[n]}return t},toString:function(){assertRangeValid(this||e);var t=(this||e).startContainer;if(t===(this||e).endContainer&&s(t))return t.nodeType==3||t.nodeType==4?t.data.slice((this||e).startOffset,(this||e).endOffset):"";var n=[],r=new RangeIterator(this||e,true);iterateSubtree(r,(function(e){e.nodeType!=3&&e.nodeType!=4||n.push(e.data)}));r.detach();return n.join("")},compareNode:function(t){assertRangeValid(this||e);var n=t.parentNode;var r=c(t);if(!n)throw new i("NOT_FOUND_ERR");var a=this.comparePoint(n,r),o=this.comparePoint(n,r+1);return a<0?o>0?V:H:o>0?W:k},comparePoint:function(t,n){assertRangeValid(this||e);assertNode(t,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(t,(this||e).startContainer);return f(t,n,(this||e).startContainer,(this||e).startOffset)<0?-1:f(t,n,(this||e).endContainer,(this||e).endOffset)>0?1:0},createContextualFragment:_,toHtml:function(){return rangeToHtml(this||e)},intersectsNode:function(t,n){assertRangeValid(this||e);if(m(t)!=getRangeRoot(this||e))return false;var r=t.parentNode,a=c(t);if(!r)return true;var o=f(r,a,(this||e).endContainer,(this||e).endOffset),i=f(r,a+1,(this||e).startContainer,(this||e).startOffset);return n?o<=0&&i>=0:o<0&&i>0},isPointInRange:function(t,n){assertRangeValid(this||e);assertNode(t,"HIERARCHY_REQUEST_ERR");assertSameDocumentOrFragment(t,(this||e).startContainer);return f(t,n,(this||e).startContainer,(this||e).startOffset)>=0&&f(t,n,(this||e).endContainer,(this||e).endOffset)<=0},intersectsRange:function(t){return rangesIntersect(this||e,t,false)},intersectsOrTouchesRange:function(t){return rangesIntersect(this||e,t,true)},intersection:function(t){if(this.intersectsRange(t)){var n=f((this||e).startContainer,(this||e).startOffset,t.startContainer,t.startOffset),r=f((this||e).endContainer,(this||e).endOffset,t.endContainer,t.endOffset);var a=this.cloneRange();n==-1&&a.setStart(t.startContainer,t.startOffset);r==1&&a.setEnd(t.endContainer,t.endOffset);return a}return null},union:function(t){if(this.intersectsOrTouchesRange(t)){var n=this.cloneRange();f(t.startContainer,t.startOffset,(this||e).startContainer,(this||e).startOffset)==-1&&n.setStart(t.startContainer,t.startOffset);f(t.endContainer,t.endOffset,(this||e).endContainer,(this||e).endOffset)==1&&n.setEnd(t.endContainer,t.endOffset);return n}throw new i("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,false):this.compareNode(e)==k},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,h(e))<=0},containsRange:function(e){var t=this.intersection(e);return t!==null&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();t.setEnd(r,r.length);return this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(t,n){assertRangeValid(this||e);return getNodesInRange(this||e,t,n)},getDocument:function(){return getRangeDocument(this||e)},collapseBefore:function(e){this.setEndBefore(e);this.collapse(false)},collapseAfter:function(e){this.setStartAfter(e);this.collapse(true)},getBookmark:function(n){var a=getRangeDocument(this||e);var o=t.createRange(a);n=n||r.getBody(a);o.selectNodeContents(n);var i=this.intersection(o);var s=0,c=0;if(i){o.setEnd(i.startContainer,i.startOffset);s=o.toString().length;c=s+i.toString().length}return{start:s,end:c,containerNode:n}},moveToBookmark:function(e){var t=e.containerNode;var n=0;this.setStart(t,0);this.collapse(true);var r,a=[t],o=false,i=false;var s,c,d;while(!i&&(r=a.pop()))if(r.nodeType==3){s=n+r.length;if(!o&&e.start>=n&&e.start<=s){this.setStart(r,e.start-n);o=true}if(o&&e.end>=n&&e.end<=s){this.setEnd(r,e.end-n);i=true}n=s}else{d=r.childNodes;c=d.length;while(c--)a.push(d[c])}},getName:function(){return"DomRange"},equals:function(t){return Range.rangesEqual(this||e,t)},isValid:function(){return isRangeValid(this||e)},inspect:function(){return inspect(this||e)},detach:function(){}});function copyComparisonConstantsToObject(e){e.START_TO_START=I;e.START_TO_END=b;e.END_TO_END=B;e.END_TO_START=M;e.NODE_BEFORE=H;e.NODE_AFTER=W;e.NODE_BEFORE_AND_AFTER=V;e.NODE_INSIDE=k}function copyComparisonConstants(e){copyComparisonConstantsToObject(e);copyComparisonConstantsToObject(e.prototype)}function createRangeContentRemover(t,n){return function(){assertRangeValid(this||e);var r=(this||e).startContainer,a=(this||e).startOffset,o=(this||e).commonAncestorContainer;var i=new RangeIterator(this||e,true);var s,c;if(r!==o){s=g(r,o,true);c=getBoundaryAfterNode(s);r=c.node;a=c.offset}iterateSubtree(i,assertNodeNotReadOnly);i.reset();var d=t(i);i.detach();n(this||e,r,a,r,a);return d}}function createPrototypeRange(n,r){function createBeforeAfterNodeSetter(t,n){return function(r){assertValidNodeType(r,N);assertValidNodeType(m(r),C);var a=(t?getBoundaryBeforeNode:getBoundaryAfterNode)(r);(n?setRangeStart:setRangeEnd)(this||e,a.node,a.offset)}}function setRangeStart(e,t,n){var a=e.endContainer,o=e.endOffset;if(t!==e.startContainer||n!==e.startOffset){if(m(t)!=m(a)||f(t,n,a,o)==1){a=t;o=n}r(e,t,n,a,o)}}function setRangeEnd(e,t,n){var a=e.startContainer,o=e.startOffset;if(t!==e.endContainer||n!==e.endOffset){if(m(t)!=m(a)||f(t,n,a,o)==-1){a=t;o=n}r(e,a,o,t,n)}}var F=function(){};F.prototype=t.rangePrototype;n.prototype=new F;a.extend(n.prototype,{setStart:function(t,n){assertNoDocTypeNotationEntityAncestor(t,true);assertValidOffset(t,n);setRangeStart(this||e,t,n)},setEnd:function(t,n){assertNoDocTypeNotationEntityAncestor(t,true);assertValidOffset(t,n);setRangeEnd(this||e,t,n)},setStartAndEnd:function(){var t=arguments;var n=t[0],a=t[1],o=n,i=a;switch(t.length){case 3:i=t[2];break;case 4:o=t[2];i=t[3];break}assertNoDocTypeNotationEntityAncestor(n,true);assertValidOffset(n,a);assertNoDocTypeNotationEntityAncestor(o,true);assertValidOffset(o,i);r(this||e,n,a,o,i)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:createBeforeAfterNodeSetter(true,true),setStartAfter:createBeforeAfterNodeSetter(false,true),setEndBefore:createBeforeAfterNodeSetter(true,false),setEndAfter:createBeforeAfterNodeSetter(false,false),collapse:function(t){assertRangeValid(this||e);t?r(this||e,(this||e).startContainer,(this||e).startOffset,(this||e).startContainer,(this||e).startOffset):r(this||e,(this||e).endContainer,(this||e).endOffset,(this||e).endContainer,(this||e).endOffset)},selectNodeContents:function(t){assertNoDocTypeNotationEntityAncestor(t,true);r(this||e,t,0,t,h(t))},selectNode:function(t){assertNoDocTypeNotationEntityAncestor(t,false);assertValidNodeType(t,N);var n=getBoundaryBeforeNode(t),a=getBoundaryAfterNode(t);r(this||e,n.node,n.offset,a.node,a.offset)},extractContents:createRangeContentRemover(extractSubtree,r),deleteContents:createRangeContentRemover(deleteSubtree,r),canSurroundContents:function(){assertRangeValid(this||e);assertNodeNotReadOnly((this||e).startContainer);assertNodeNotReadOnly((this||e).endContainer);var t=new RangeIterator(this||e,true);var n=t._first&&isNonTextPartiallySelected(t._first,this||e)||t._last&&isNonTextPartiallySelected(t._last,this||e);t.detach();return!n},splitBoundaries:function(){splitRangeBoundaries(this||e)},splitBoundariesPreservingPositions:function(t){splitRangeBoundaries(this||e,t)},normalizeBoundaries:function(){assertRangeValid(this||e);var t=(this||e).startContainer,n=(this||e).startOffset,a=(this||e).endContainer,o=(this||e).endOffset;var mergeForward=function(e){var t=e.nextSibling;if(t&&t.nodeType==e.nodeType){a=e;o=e.length;e.appendData(t.data);R(t)}};var mergeBackward=function(e){var r=e.previousSibling;if(r&&r.nodeType==e.nodeType){t=e;var i=e.length;n=r.length;e.insertData(0,r.data);R(r);if(t==a){o+=n;a=t}else if(a==e.parentNode){var s=c(e);if(o==s){a=e;o=i}else o>s&&o--}}};var i=true;var d;if(s(a)){if(o==a.length)mergeForward(a);else if(o==0){d=a.previousSibling;if(d&&d.nodeType==a.nodeType){o=d.length;t==a&&(i=false);d.appendData(a.data);R(a);a=d}}}else{if(o>0){var l=a.childNodes[o-1];l&&s(l)&&mergeForward(l)}i=!(this||e).collapsed}if(i){if(s(t)){if(n==0)mergeBackward(t);else if(n==t.length){d=t.nextSibling;if(d&&d.nodeType==t.nodeType){if(a==d){a=t;o+=t.length}t.appendData(d.data);R(d)}}}else if(n<t.childNodes.length){var f=t.childNodes[n];f&&s(f)&&mergeBackward(f)}}else{t=a;n=o}r(this||e,t,n,a,o)},collapseToPoint:function(e,t){assertNoDocTypeNotationEntityAncestor(e,true);assertValidOffset(e,t);this.setStartAndEnd(e,t)},parentElement:function(){assertRangeValid(this||e);var t=(this||e).commonAncestorContainer;return t?D((this||e).commonAncestorContainer,true):null}});copyComparisonConstants(n)}function updateCollapsedAndCommonAncestor(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset;e.commonAncestorContainer=e.collapsed?e.startContainer:r.getCommonAncestor(e.startContainer,e.endContainer)}function updateBoundaries(e,t,n,a,o){e.startContainer=t;e.startOffset=n;e.endContainer=a;e.endOffset=o;e.document=r.getDocument(t);updateCollapsedAndCommonAncestor(e)}function Range(t){updateBoundaries(this||e,t,0,t,0)}createPrototypeRange(Range,updateBoundaries);a.extend(Range,{rangeProperties:P,RangeIterator:RangeIterator,copyComparisonConstants:copyComparisonConstants,createPrototypeRange:createPrototypeRange,inspect:inspect,toHtml:rangeToHtml,getRangeDocument:getRangeDocument,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}});t.DomRange=Range}));p.createCoreModule("WrappedRange",["DomRange"],(function(t,n){var r,a;var o=t.dom;var i=t.util;var s=o.DomPosition;var c=t.DomRange;var d=o.getBody;var l=o.getContentDocument;var f=o.isCharacterDataNode;t.features.implementsDomRange&&function(){var a;var s=c.rangeProperties;function updateRangeProperties(e){var t,n=s.length;while(n--){t=s[n];e[t]=e.nativeRange[t]}e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function updateNativeRange(e,t,n,r,a){var o=e.startContainer!==t||e.startOffset!=n;var i=e.endContainer!==r||e.endOffset!=a;var s=!e.equals(e.nativeRange);if(o||i||s){e.setEnd(r,a);e.setStart(t,n)}}var f;r=function(t){if(!t)throw n.createError("WrappedRange: Range must be specified");(this||e).nativeRange=t;updateRangeProperties(this||e)};c.createPrototypeRange(r,updateNativeRange);a=r.prototype;a.selectNode=function(t){(this||e).nativeRange.selectNode(t);updateRangeProperties(this||e)};a.cloneContents=function(){return(this||e).nativeRange.cloneContents()};a.surroundContents=function(t){(this||e).nativeRange.surroundContents(t);updateRangeProperties(this||e)};a.collapse=function(t){(this||e).nativeRange.collapse(t);updateRangeProperties(this||e)};a.cloneRange=function(){return new r((this||e).nativeRange.cloneRange())};a.refresh=function(){updateRangeProperties(this||e)};a.toString=function(){return(this||e).nativeRange.toString()};var u=document.createTextNode("test");d(document).appendChild(u);var g=document.createRange();g.setStart(u,0);g.setEnd(u,0);try{g.setStart(u,1);a.setStart=function(t,n){(this||e).nativeRange.setStart(t,n);updateRangeProperties(this||e)};a.setEnd=function(t,n){(this||e).nativeRange.setEnd(t,n);updateRangeProperties(this||e)};f=function(t){return function(n){(this||e).nativeRange[t](n);updateRangeProperties(this||e)}}}catch(t){a.setStart=function(t,n){try{(this||e).nativeRange.setStart(t,n)}catch(r){(this||e).nativeRange.setEnd(t,n);(this||e).nativeRange.setStart(t,n)}updateRangeProperties(this||e)};a.setEnd=function(t,n){try{(this||e).nativeRange.setEnd(t,n)}catch(r){(this||e).nativeRange.setStart(t,n);(this||e).nativeRange.setEnd(t,n)}updateRangeProperties(this||e)};f=function(t,n){return function(r){try{(this||e).nativeRange[t](r)}catch(a){(this||e).nativeRange[n](r);(this||e).nativeRange[t](r)}updateRangeProperties(this||e)}}}a.setStartBefore=f("setStartBefore","setEndBefore");a.setStartAfter=f("setStartAfter","setEndAfter");a.setEndBefore=f("setEndBefore","setStartBefore");a.setEndAfter=f("setEndAfter","setStartAfter");a.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))};g.selectNodeContents(u);g.setEnd(u,3);var h=document.createRange();h.selectNodeContents(u);h.setEnd(u,4);h.setStart(u,2);g.compareBoundaryPoints(g.START_TO_END,h)==-1&&g.compareBoundaryPoints(g.END_TO_START,h)==1?a.compareBoundaryPoints=function(t,n){n=n.nativeRange||n;t==n.START_TO_END?t=n.END_TO_START:t==n.END_TO_START&&(t=n.START_TO_END);return(this||e).nativeRange.compareBoundaryPoints(t,n)}:a.compareBoundaryPoints=function(t,n){return(this||e).nativeRange.compareBoundaryPoints(t,n.nativeRange||n)};var p=document.createElement("div");p.innerHTML="123";var m=p.firstChild;var v=d(document);v.appendChild(p);g.setStart(m,1);g.setEnd(m,2);g.deleteContents();if(m.data=="13"){a.deleteContents=function(){(this||e).nativeRange.deleteContents();updateRangeProperties(this||e)};a.extractContents=function(){var t=(this||e).nativeRange.extractContents();updateRangeProperties(this||e);return t}}v.removeChild(p);v=null;i.isHostMethod(g,"createContextualFragment")&&(a.createContextualFragment=function(t){return(this||e).nativeRange.createContextualFragment(t)});d(document).removeChild(u);a.getName=function(){return"WrappedRange"};t.WrappedRange=r;t.createNativeRange=function(e){e=l(e,n,"createNativeRange");return e.createRange()}}();if(t.features.implementsTextRange){var getTextRangeContainerElement=function(e){var t=e.parentElement();var n=e.duplicate();n.collapse(true);var r=n.parentElement();n=e.duplicate();n.collapse(false);var a=n.parentElement();var i=r==a?r:o.getCommonAncestor(r,a);return i==t?i:o.getCommonAncestor(t,i)};var textRangeIsCollapsed=function(e){return e.compareEndPoints("StartToEnd",e)==0};var getTextRangeBoundaryPosition=function(e,t,n,r,a){var i=e.duplicate();i.collapse(n);var c=i.parentElement();o.isOrIsAncestorOf(t,c)||(c=t);if(!c.canHaveHTML){var d=new s(c.parentNode,o.getNodeIndex(c));return{boundaryPosition:d,nodeInfo:{nodeIndex:d.offset,containerElement:d.node}}}var l=o.getDocument(c).createElement("span");l.parentNode&&o.removeNode(l);var u,g=n?"StartToStart":"StartToEnd";var h,p,m,v;var R=a&&a.containerElement==c?a.nodeIndex:0;var N=c.childNodes.length;var C=N;var S=C;while(true){S==N?c.appendChild(l):c.insertBefore(l,c.childNodes[S]);i.moveToElementText(l);u=i.compareEndPoints(g,e);if(u==0||R==C)break;if(u==-1){if(C==R+1)break;R=S}else C=C==R+1?R:S;S=Math.floor((R+C)/2);c.removeChild(l)}v=l.nextSibling;if(u==-1&&v&&f(v)){i.setEndPoint(n?"EndToStart":"EndToEnd",e);var y;if(/[\r\n]/.test(v.data)){var E=i.duplicate();var T=E.text.replace(/\r\n/g,"\r").length;y=E.moveStart("character",T);while((u=E.compareEndPoints("StartToEnd",E))==-1){y++;E.moveStart("character",1)}}else y=i.text.length;m=new s(v,y)}else{h=(r||!n)&&l.previousSibling;p=(r||n)&&l.nextSibling;m=p&&f(p)?new s(p,0):h&&f(h)?new s(h,h.data.length):new s(c,o.getNodeIndex(l))}o.removeNode(l);return{boundaryPosition:m,nodeInfo:{nodeIndex:S,containerElement:c}}};var createBoundaryTextRange=function(e,t){var n,r,a=e.offset;var i=o.getDocument(e.node);var s,c,l=d(i).createTextRange();var u=f(e.node);if(u){n=e.node;r=n.parentNode}else{c=e.node.childNodes;n=a<c.length?c[a]:null;r=e.node}s=i.createElement("span");s.innerHTML="&#feff;";n?r.insertBefore(s,n):r.appendChild(s);l.moveToElementText(s);l.collapse(!t);r.removeChild(s);u&&l[t?"moveStart":"moveEnd"]("character",a);return l};a=function(t){(this||e).textRange=t;this.refresh()};a.prototype=new c(document);a.prototype.refresh=function(){var t,n,r;var a=getTextRangeContainerElement((this||e).textRange);if(textRangeIsCollapsed((this||e).textRange))n=t=getTextRangeBoundaryPosition((this||e).textRange,a,true,true).boundaryPosition;else{r=getTextRangeBoundaryPosition((this||e).textRange,a,true,false);t=r.boundaryPosition;n=getTextRangeBoundaryPosition((this||e).textRange,a,false,false,r.nodeInfo).boundaryPosition}this.setStart(t.node,t.offset);this.setEnd(n.node,n.offset)};a.prototype.getName=function(){return"WrappedTextRange"};c.copyComparisonConstants(a);var rangeToTextRange=function(e){if(e.collapsed)return createBoundaryTextRange(new s(e.startContainer,e.startOffset),true);var t=createBoundaryTextRange(new s(e.startContainer,e.startOffset),true);var n=createBoundaryTextRange(new s(e.endContainer,e.endOffset),false);var r=d(c.getRangeDocument(e)).createTextRange();r.setEndPoint("StartToStart",t);r.setEndPoint("EndToEnd",n);return r};a.rangeToTextRange=rangeToTextRange;a.prototype.toTextRange=function(){return rangeToTextRange(this||e)};t.WrappedTextRange=a;if(!t.features.implementsDomRange||t.config.preferTextRange){var u=function(e){return e("return this;")()}(Function);typeof u.Range=="undefined"&&(u.Range=a);t.createNativeRange=function(e){e=l(e,n,"createNativeRange");return d(e).createTextRange()};t.WrappedRange=a}}t.createRange=function(e){e=l(e,n,"createRange");return new t.WrappedRange(t.createNativeRange(e))};t.createRangyRange=function(e){e=l(e,n,"createRangyRange");return new c(e)};i.createAliasForDeprecatedMethod(t,"createIframeRange","createRange");i.createAliasForDeprecatedMethod(t,"createIframeRangyRange","createRangyRange");t.addShimListener((function(e){var n=e.document;typeof n.createRange=="undefined"&&(n.createRange=function(){return t.createRange(n)});n=e=null}))}));p.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],(function(t,n){t.config.checkSelectionRanges=true;var r="boolean";var a="number";var o=t.dom;var i=t.util;var s=i.isHostMethod;var c=t.DomRange;var d=t.WrappedRange;var l=t.DOMException;var f=o.DomPosition;var u;var g;var h=t.features;var p="Control";var m=o.getDocument;var v=o.getBody;var R=c.rangesEqual;function isDirectionBackward(e){return typeof e=="string"?/^backward(s)?$/i.test(e):!!e}function getWindow(e,t){if(e){if(o.isWindow(e))return e;if(e instanceof WrappedSelection)return e.win;var r=o.getContentDocument(e,n,t);return o.getWindow(r)}return window}function getWinSelection(e){return getWindow(e,"getWinSelection").getSelection()}function getDocSelection(e){return getWindow(e,"getDocSelection").document.selection}function winSelectionIsBackward(e){var t=false;e.anchorNode&&(t=o.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)==1);return t}var N=s(window,"getSelection"),C=i.isHostObject(document,"selection");h.implementsWinGetSelection=N;h.implementsDocSelection=C;var S=C&&(!N||t.config.preferTextRange);if(S){u=getDocSelection;t.isSelectionValid=function(e){var t=getWindow(e,"isSelectionValid").document,n=t.selection;return n.type!="None"||m(n.createRange().parentElement())==t}}else{if(!N){n.fail("Neither document.selection or window.getSelection() detected.");return false}u=getWinSelection;t.isSelectionValid=function(){return true}}t.getNativeSelection=u;var y=u();if(!y){n.fail("Native selection was null (possibly issue 138?)");return false}var E=t.createNativeRange(document);var T=v(document);var w=i.areHostProperties(y,["anchorNode","focusNode","anchorOffset","focusOffset"]);h.selectionHasAnchorAndFocus=w;var O=s(y,"extend");h.selectionHasExtend=O;var D=s(y,"setBaseAndExtent");h.selectionHasSetBaseAndExtent=D;var A=typeof y.rangeCount==a;h.selectionHasRangeCount=A;var x=false;var _=true;var P=O?function(e,n){var r=c.getRangeDocument(n);var a=t.createRange(r);a.collapseToPoint(n.endContainer,n.endOffset);e.addRange(getNativeRange(a));e.extend(n.startContainer,n.startOffset)}:null;i.areHostMethods(y,["addRange","getRangeAt","removeAllRanges"])&&typeof y.rangeCount==a&&h.implementsDomRange&&function(){var e=window.getSelection();if(e){var n=e.rangeCount;var r=n>1;var a=[];var i=winSelectionIsBackward(e);for(var s=0;s<n;++s)a[s]=e.getRangeAt(s);var c=o.createTestElement(document,"",false);var d=c.appendChild(document.createTextNode("   "));var l=document.createRange();l.setStart(d,1);l.collapse(true);e.removeAllRanges();e.addRange(l);_=e.rangeCount==1;e.removeAllRanges();if(!r){var f=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(f&&parseInt(f[1])>=36)x=false;else{var u=l.cloneRange();l.setStart(d,0);u.setEnd(d,3);u.setStart(d,2);e.addRange(l);e.addRange(u);x=e.rangeCount==2}}o.removeNode(c);e.removeAllRanges();for(s=0;s<n;++s)if(s==0&&i)if(P)P(e,a[s]);else{t.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend");e.addRange(a[s])}else e.addRange(a[s])}}();h.selectionSupportsMultipleRanges=x;h.collapsedNonEditableSelectionsSupported=_;var I,b=false;if(T&&s(T,"createControlRange")){I=T.createControlRange();i.areHostProperties(I,["item","add"])&&(b=true)}h.implementsControlRange=b;g=w?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed};function updateAnchorAndFocusFromRange(e,t,n){var r=n?"end":"start",a=n?"start":"end";e.anchorNode=t[r+"Container"];e.anchorOffset=t[r+"Offset"];e.focusNode=t[a+"Container"];e.focusOffset=t[a+"Offset"]}function updateAnchorAndFocusFromNativeSelection(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode;e.anchorOffset=t.anchorOffset;e.focusNode=t.focusNode;e.focusOffset=t.focusOffset}function updateEmptySelection(e){e.anchorNode=e.focusNode=null;e.anchorOffset=e.focusOffset=0;e.rangeCount=0;e.isCollapsed=true;e._ranges.length=0;updateType(e)}function updateType(e){e.type=e.rangeCount==0?"None":g(e)?"Caret":"Range"}function getNativeRange(e){var n;if(e instanceof c){n=t.createNativeRange(e.getDocument());n.setEnd(e.endContainer,e.endOffset);n.setStart(e.startContainer,e.startOffset)}else e instanceof d?n=e.nativeRange:h.implementsDomRange&&e instanceof o.getWindow(e.startContainer).Range&&(n=e);return n}function rangeContainsSingleElement(e){if(!e.length||e[0].nodeType!=1)return false;for(var t=1,n=e.length;t<n;++t)if(!o.isAncestorOf(e[0],e[t]))return false;return true}function getSingleElementFromRange(e){var t=e.getNodes();if(!rangeContainsSingleElement(t))throw n.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function isTextRange(e){return!!e&&typeof e.text!="undefined"}function updateFromTextRange(e,t){var n=new d(t);e._ranges=[n];updateAnchorAndFocusFromRange(e,n,false);e.rangeCount=1;e.isCollapsed=n.collapsed;updateType(e)}function updateControlSelection(e){e._ranges.length=0;if(e.docSelection.type=="None")updateEmptySelection(e);else{var n=e.docSelection.createRange();if(isTextRange(n))updateFromTextRange(e,n);else{e.rangeCount=n.length;var r,a=m(n.item(0));for(var o=0;o<e.rangeCount;++o){r=t.createRange(a);r.selectNode(n.item(o));e._ranges.push(r)}e.isCollapsed=e.rangeCount==1&&e._ranges[0].collapsed;updateAnchorAndFocusFromRange(e,e._ranges[e.rangeCount-1],false);updateType(e)}}}function addRangeToControlSelection(e,t){var r=e.docSelection.createRange();var a=getSingleElementFromRange(t);var o=m(r.item(0));var i=v(o).createControlRange();for(var s=0,c=r.length;s<c;++s)i.add(r.item(s));try{i.add(a)}catch(e){throw n.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}i.select();updateControlSelection(e)}var B;s(y,"getRangeAt")?B=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:w&&(B=function(n){var r=m(n.anchorNode);var a=t.createRange(r);a.setStartAndEnd(n.anchorNode,n.anchorOffset,n.focusNode,n.focusOffset);a.collapsed!==(this||e).isCollapsed&&a.setStartAndEnd(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset);return a});function WrappedSelection(t,n,r){(this||e).nativeSelection=t;(this||e).docSelection=n;(this||e)._ranges=[];(this||e).win=r;this.refresh()}WrappedSelection.prototype=t.selectionPrototype;function deleteProperties(e){e.win=e.anchorNode=e.focusNode=e._ranges=null;e.rangeCount=e.anchorOffset=e.focusOffset=0;e.detached=true;updateType(e)}var M=[];function actOnCachedSelection(e,t){var n,r,a=M.length;while(a--){n=M[a];r=n.selection;if(t=="deleteAll")deleteProperties(r);else if(n.win==e){if(t=="delete"){M.splice(a,1);return true}return r}}t=="deleteAll"&&(M.length=0);return null}var getSelection=function(e){if(e&&e instanceof WrappedSelection){e.refresh();return e}e=getWindow(e,"getNativeSelection");var t=actOnCachedSelection(e);var n=u(e),r=C?getDocSelection(e):null;if(t){t.nativeSelection=n;t.docSelection=r;t.refresh()}else{t=new WrappedSelection(n,r,e);M.push({win:e,selection:t})}return t};t.getSelection=getSelection;i.createAliasForDeprecatedMethod(t,"getIframeSelection","getSelection");var H=WrappedSelection.prototype;function createControlSelection(e,t){var r=m(t[0].startContainer);var a=v(r).createControlRange();for(var o,i=0,s=t.length;i<s;++i){o=getSingleElementFromRange(t[i]);try{a.add(o)}catch(e){throw n.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}a.select();updateControlSelection(e)}if(!S&&w&&i.areHostMethods(y,["removeAllRanges","addRange"])){H.removeAllRanges=function(){(this||e).nativeSelection.removeAllRanges();updateEmptySelection(this||e)};var addRangeBackward=function(e,t){P(e.nativeSelection,t);e.refresh()};H.addRange=A?function(n,r){if(b&&C&&(this||e).docSelection.type==p)addRangeToControlSelection(this||e,n);else if(isDirectionBackward(r)&&O)addRangeBackward(this||e,n);else{var a;if(x)a=(this||e).rangeCount;else{this.removeAllRanges();a=0}var o=getNativeRange(n).cloneRange();try{(this||e).nativeSelection.addRange(o)}catch(e){}(this||e).rangeCount=(this||e).nativeSelection.rangeCount;if((this||e).rangeCount==a+1){if(t.config.checkSelectionRanges){var i=B((this||e).nativeSelection,(this||e).rangeCount-1);i&&!R(i,n)&&(n=new d(i))}(this||e)._ranges[(this||e).rangeCount-1]=n;updateAnchorAndFocusFromRange(this||e,n,V((this||e).nativeSelection));(this||e).isCollapsed=g(this||e);updateType(this||e)}else this.refresh()}}:function(t,n){if(isDirectionBackward(n)&&O)addRangeBackward(this||e,t);else{(this||e).nativeSelection.addRange(getNativeRange(t));this.refresh()}};H.setRanges=function(t){if(b&&C&&t.length>1)createControlSelection(this||e,t);else{this.removeAllRanges();for(var n=0,r=t.length;n<r;++n)this.addRange(t[n])}}}else{if(!(s(y,"empty")&&s(E,"select")&&b&&S)){n.fail("No means of selecting a Range or TextRange was found");return false}H.removeAllRanges=function(){try{(this||e).docSelection.empty();if((this||e).docSelection.type!="None"){var t;if((this||e).anchorNode)t=m((this||e).anchorNode);else if((this||e).docSelection.type==p){var n=(this||e).docSelection.createRange();n.length&&(t=m(n.item(0)))}if(t){var r=v(t).createTextRange();r.select();(this||e).docSelection.empty()}}}catch(e){}updateEmptySelection(this||e)};H.addRange=function(n){if((this||e).docSelection.type==p)addRangeToControlSelection(this||e,n);else{t.WrappedTextRange.rangeToTextRange(n).select();(this||e)._ranges[0]=n;(this||e).rangeCount=1;(this||e).isCollapsed=(this||e)._ranges[0].collapsed;updateAnchorAndFocusFromRange(this||e,n,false);updateType(this||e)}};H.setRanges=function(t){this.removeAllRanges();var n=t.length;n>1?createControlSelection(this||e,t):n&&this.addRange(t[0])}}H.getRangeAt=function(t){if(t<0||t>=(this||e).rangeCount)throw new l("INDEX_SIZE_ERR");return(this||e)._ranges[t].cloneRange()};var W;if(S)W=function(e){var n;if(t.isSelectionValid(e.win))n=e.docSelection.createRange();else{n=v(e.win.document).createTextRange();n.collapse(true)}e.docSelection.type==p?updateControlSelection(e):isTextRange(n)?updateFromTextRange(e,n):updateEmptySelection(e)};else if(s(y,"getRangeAt")&&typeof y.rangeCount==a)W=function(e){if(b&&C&&e.docSelection.type==p)updateControlSelection(e);else{e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount;if(e.rangeCount){for(var n=0,r=e.rangeCount;n<r;++n)e._ranges[n]=new t.WrappedRange(e.nativeSelection.getRangeAt(n));updateAnchorAndFocusFromRange(e,e._ranges[e.rangeCount-1],V(e.nativeSelection));e.isCollapsed=g(e);updateType(e)}else updateEmptySelection(e)}};else{if(!w||typeof y.isCollapsed!=r||typeof E.collapsed!=r||!h.implementsDomRange){n.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}W=function(e){var t,n=e.nativeSelection;if(n.anchorNode){t=B(n,0);e._ranges=[t];e.rangeCount=1;updateAnchorAndFocusFromNativeSelection(e);e.isCollapsed=g(e);updateType(e)}else updateEmptySelection(e)}}H.refresh=function(t){var n=t?(this||e)._ranges.slice(0):null;var r=(this||e).anchorNode,a=(this||e).anchorOffset;W(this||e);if(t){var o=n.length;if(o!=(this||e)._ranges.length)return true;if((this||e).anchorNode!=r||(this||e).anchorOffset!=a)return true;while(o--)if(!R(n[o],(this||e)._ranges[o]))return true;return false}};var removeRangeManually=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,a=n.length;r<a;++r)R(t,n[r])||e.addRange(n[r]);e.rangeCount||updateEmptySelection(e)};H.removeRange=b&&C?function(t){if((this||e).docSelection.type==p){var n=(this||e).docSelection.createRange();var r=getSingleElementFromRange(t);var a=m(n.item(0));var o=v(a).createControlRange();var i,s=false;for(var c=0,d=n.length;c<d;++c){i=n.item(c);i!==r||s?o.add(n.item(c)):s=true}o.select();updateControlSelection(this||e)}else removeRangeManually(this||e,t)}:function(t){removeRangeManually(this||e,t)};var V;if(!S&&w&&h.implementsDomRange){V=winSelectionIsBackward;H.isBackward=function(){return V(this||e)}}else V=H.isBackward=function(){return false};H.isBackwards=H.isBackward;H.toString=function(){var t=[];for(var n=0,r=(this||e).rangeCount;n<r;++n)t[n]=""+(this||e)._ranges[n];return t.join("")};function assertNodeInSameDocument(e,t){if(e.win.document!=m(t))throw new l("WRONG_DOCUMENT_ERR")}function assertValidOffset(e,t){if(t<0||t>(o.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new l("INDEX_SIZE_ERR")}H.collapse=function(n,r){assertNodeInSameDocument(this||e,n);var a=t.createRange(n);a.collapseToPoint(n,r);this.setSingleRange(a);(this||e).isCollapsed=true};H.collapseToStart=function(){if(!(this||e).rangeCount)throw new l("INVALID_STATE_ERR");var t=(this||e)._ranges[0];this.collapse(t.startContainer,t.startOffset)};H.collapseToEnd=function(){if(!(this||e).rangeCount)throw new l("INVALID_STATE_ERR");var t=(this||e)._ranges[(this||e).rangeCount-1];this.collapse(t.endContainer,t.endOffset)};H.selectAllChildren=function(n){assertNodeInSameDocument(this||e,n);var r=t.createRange(n);r.selectNodeContents(n);this.setSingleRange(r)};D?H.setBaseAndExtent=function(t,n,r,a){(this||e).nativeSelection.setBaseAndExtent(t,n,r,a);this.refresh()}:O&&(H.setBaseAndExtent=function(n,r,a,i){assertValidOffset(n,r);assertValidOffset(a,i);assertNodeInSameDocument(this||e,n);assertNodeInSameDocument(this||e,a);var s=t.createRange(node);var c=o.comparePoints(n,r,a,i)==-1;c?s.setStartAndEnd(a,i,n,r):s.setStartAndEnd(n,r,a,i);this.setSingleRange(s,c)});H.deleteFromDocument=function(){if(b&&C&&(this||e).docSelection.type==p){var t=(this||e).docSelection.createRange();var n;while(t.length){n=t.item(0);t.remove(n);o.removeNode(n)}this.refresh()}else if((this||e).rangeCount){var r=this.getAllRanges();if(r.length){this.removeAllRanges();for(var a=0,i=r.length;a<i;++a)r[a].deleteContents();this.addRange(r[i-1])}}};H.eachRange=function(t,n){for(var r=0,a=(this||e)._ranges.length;r<a;++r)if(t(this.getRangeAt(r)))return n};H.getAllRanges=function(){var e=[];this.eachRange((function(t){e.push(t)}));return e};H.setSingleRange=function(e,t){this.removeAllRanges();this.addRange(e,t)};H.callMethodOnEachRange=function(e,t){var n=[];this.eachRange((function(r){n.push(r[e].apply(r,t||[]))}));return n};function createStartOrEndSetter(n){return function(r,a){var o;if((this||e).rangeCount){o=this.getRangeAt(0);o["set"+(n?"Start":"End")](r,a)}else{o=t.createRange((this||e).win.document);o.setStartAndEnd(r,a)}this.setSingleRange(o,this.isBackward())}}H.setStart=createStartOrEndSetter(true);H.setEnd=createStartOrEndSetter(false);t.rangePrototype.select=function(t){getSelection(this.getDocument()).setSingleRange(this||e,t)};H.changeEachRange=function(e){var t=[];var n=this.isBackward();this.eachRange((function(n){e(n);t.push(n)}));this.removeAllRanges();n&&t.length==1?this.addRange(t[0],"backward"):this.setRanges(t)};H.containsNode=function(e,t){return this.eachRange((function(n){return n.containsNode(e,t)}),true)||false};H.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}};H.moveToBookmark=function(n){var r=[];for(var a,o,i=0;a=n.rangeBookmarks[i++];){o=t.createRange((this||e).win);o.moveToBookmark(a);r.push(o)}n.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)};H.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}};H.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&n==0)};H.toHtml=function(){var e=[];this.eachRange((function(t){e.push(c.toHtml(t))}));return e.join("")};h.implementsTextRange&&(H.getNativeTextRange=function(){var r;if(r=(this||e).docSelection){var a=r.createRange();if(isTextRange(a))return a;throw n.createError("getNativeTextRange: selection is a control selection")}if((this||e).rangeCount>0)return t.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw n.createError("getNativeTextRange: selection contains no range")});function inspect(e){var t=[];var n=new f(e.anchorNode,e.anchorOffset);var r=new f(e.focusNode,e.focusOffset);var a=typeof e.getName=="function"?e.getName():"Selection";if(typeof e.rangeCount!="undefined")for(var o=0,i=e.rangeCount;o<i;++o)t[o]=c.inspect(e.getRangeAt(o));return"["+a+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}H.getName=function(){return"WrappedSelection"};H.inspect=function(){return inspect(this||e)};H.detach=function(){actOnCachedSelection((this||e).win,"delete");deleteProperties(this||e)};WrappedSelection.detachAll=function(){actOnCachedSelection(null,"deleteAll")};WrappedSelection.inspect=inspect;WrappedSelection.isDirectionBackward=isDirectionBackward;t.Selection=WrappedSelection;t.selectionPrototype=H;t.addShimListener((function(e){typeof e.getSelection=="undefined"&&(e.getSelection=function(){return getSelection(e)});e=null}))}));var C=false;var loadHandler=function(e){if(!C){C=true;!p.initialized&&p.config.autoInitialize&&init()}};if(g)if(document.readyState=="complete")loadHandler();else{isHostMethod(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",loadHandler,false);v(window,"load",loadHandler)}return p}));var n=t;export{n as default};

